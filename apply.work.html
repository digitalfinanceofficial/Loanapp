<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Apply — Work Details | SmartCash Finance</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --ink:#0A2F33; --brand:#1f5d63; --ok:#10b981; --muted:#e5e7eb; }
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .nav-link{padding:.5rem 1rem;border-radius:9999px}
    .nav-active{background:#0A2F33;color:#fff !important}
    .card{border-radius:1.25rem;box-shadow:0 12px 32px rgba(0,0,0,.08)}
    .err{display:none}.has-error .err{display:block}
    .teal-dots{
      background:
        radial-gradient(circle at 12px 12px, rgba(255,255,255,.07) 2px, transparent 2.6px) 0 0/24px 24px,
        #1f5d63;
    }
    .step-dot{width:12px;height:12px;border-radius:9999px;background:#d1d5db}
    .step-dot.done{background:var(--ok)}
    .step-dot.active{background:#f59e0b}
    .linkbar{height:6px;border-radius:9999px;background:var(--muted);overflow:hidden;position:relative}
    .linkfill{height:100%;width:0;background:var(--ok);transition:width .25s ease}
    .label{font-size:12px}
    .lock-note{background:#fff3cd;border:1px solid #ffe69c;color:#664d03}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
<header class="border-b bg-white sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3">
      <img src="assets/logo.png" class="w-12 h-12 rounded-lg" alt="SmartCash"/>
      <div>
        <div class="text-xl font-extrabold text-blue-700 leading-tight">SmartCash</div>
        <div class="text-[11px] tracking-widest text-blue-600 uppercase">Finance</div>
      </div>
    </a>
    <nav class="hidden md:flex items-center gap-2 text-sm">
      <a href="index.html" class="nav-link">Home</a>
      <a href="loan-products.html" class="nav-link">Products</a>
      <a href="about.html" class="nav-link">About Us</a>
      <a href="contact.html" class="nav-link">Contact</a>
      <a href="calculator.html" class="nav-link">EMI Calculator</a>
      <a href="status.html" class="nav-link">Status Check</a>
    </nav>
    <button id="menuBtn" class="md:hidden p-2 rounded-lg border" aria-label="Open menu">
      <svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 7h16M4 12h16M4 17h16" stroke="#111827" stroke-width="2" stroke-linecap="round"/></svg>
    </button>
  </div>
  <div id="mobileMenu" class="hidden md:hidden border-t bg-white">
    <div class="max-w-7xl mx-auto px-4 py-3 grid gap-2 text-sm">
      <a class="py-2 border-b" href="index.html">Home</a>
      <a class="py-2 border-b" href="loan-products.html">Products</a>
      <a class="py-2 border-b" href="about.html">About Us</a>
      <a class="py-2 border-b" href="status.html">Status Check</a>
      <a class="py-2" href="calculator.html">EMI Calculator</a>
    </div>
  </div>
</header>

<section class="teal-dots text-white">
  <div class="max-w-7xl mx-auto px-6 py-8">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold">Work Details</h1>
        <p class="text-white/90 mt-2">Tell us about your employment to continue your application.</p>
      </div>
      <div id="appIdPill" class="hidden bg-white/15 border border-white/35 text-xs md:text-sm px-3 py-1.5 rounded-full">
        App ID: <span id="appIdText" class="font-semibold ml-1"></span>
      </div>
    </div>

    <!-- Stepper -->
    <div class="mt-6 bg-white/10 rounded-2xl px-4 py-3">
      <div class="flex items-center gap-2">
        <span id="dot1" class="step-dot done"></span>
        <div class="flex-1 linkbar"><div class="linkfill" style="width:100%"></div></div>
        <span id="dot2" class="step-dot active"></span>
        <div class="flex-1 linkbar" id="bar2"></div>
        <span id="dot3" class="step-dot"></span>
        <div class="flex-1 linkbar" id="bar3"></div>
        <span id="dot4" class="step-dot"></span>
        <div class="flex-1 linkbar" id="bar4"></div>
        <span id="dot5" class="step-dot"></span>
        <div class="flex-1 linkbar" id="bar5"></div>
        <span id="dot6" class="step-dot"></span>
      </div>
      <div class="grid grid-cols-6 mt-2 text-center label text-white/90">
        <div>Personal</div><div>Work</div><div>KYC</div><div>Bank</div><div>Offer</div><div>Disbursed</div>
      </div>
    </div>
  </div>
</section>

<main class="max-w-4xl mx-auto px-6 -mt-8 pb-16">
  <div id="lockNote" class="hidden lock-note rounded-xl px-4 py-3 mb-3 text-sm">
    Work details submitted. Changes are locked. Please proceed to KYC.
  </div>

  <form id="wform" class="bg-white card ring-1 ring-black/5 p-6 space-y-5" novalidate>
    <h2 class="text-2xl font-extrabold">Work Details</h2>

    <div class="grid md:grid-cols-2 gap-4">
      <div id="gEmpType">
        <label class="text-sm font-medium">Employment Type</label>
        <select id="empType" class="mt-1 w-full border rounded-lg px-3 py-2" required>
          <option value="">Select</option>
          <option>Salaried</option><option>Self Employed</option><option>Student</option><option>Other</option>
        </select>
        <p class="err text-xs text-red-600 mt-1">Select employment type.</p>
      </div>
      <div id="gCompany">
        <label class="text-sm font-medium">Company / Business</label>
        <input id="company" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="Your employer / business name" required>
        <p class="err text-xs text-red-600 mt-1">Enter company/business name.</p>
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-4">
      <div id="gIncome">
        <label class="text-sm font-medium">Monthly Income (₹)</label>
        <input id="income" inputmode="numeric" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="e.g., 35000" required>
        <p class="err text-xs text-red-600 mt-1">Enter valid income.</p>
      </div>
      <div id="gExp">
        <label class="text-sm font-medium">Total Experience (Years)</label>
        <input id="exp" inputmode="numeric" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="e.g., 2" required>
        <p class="err text-xs text-red-600 mt-1">Enter valid experience.</p>
      </div>
      <div id="gOfficePin">
        <label class="text-sm font-medium">Office Pincode</label>
        <input id="officePin" maxlength="6" inputmode="numeric" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="6-digit pincode" required>
        <p class="err text-xs text-red-600 mt-1">Enter valid pincode.</p>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div id="gOfficeCity">
        <label class="text-sm font-medium">Office City</label>
        <input id="officeCity" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="City" required>
        <p class="err text-xs text-red-600 mt-1">Enter city.</p>
      </div>
      <div id="gOfficeState">
        <label class="text-sm font-medium">Office State</label>
        <input id="officeState" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="State" required>
        <p class="err text-xs text-red-600 mt-1">Enter state.</p>
      </div>
    </div>

    <div class="flex items-center justify-between pt-2">
      <a id="backBtn" href="#" class="inline-flex items-center gap-2 px-5 py-3 rounded-full border font-semibold">← Back</a>
      <button id="nextBtn" disabled class="px-8 py-3 rounded-full font-semibold text-white bg-gray-300 cursor-not-allowed transition">Continue to KYC</button>
    </div>
  </form>
</main>

<footer class="border-t bg-white">
  <div class="max-w-7xl mx-auto px-6 py-6 text-center text-[13px] text-gray-600">
    © <span id="yr"></span> SmartCash Finance • <a class="underline" href="privacy.html">Privacy</a> • <a class="underline" href="terms.html">Terms</a>
  </div>
</footer>

<script>
const APP_KEY='scf_app', DRAFT_KEY='scf_apply_work';
document.getElementById('yr').textContent=new Date().getFullYear();
document.getElementById('menuBtn')?.addEventListener('click',()=>document.getElementById('mobileMenu').classList.toggle('hidden'));

// helpers
const isNum=v=>/^\d+$/.test(String(v||'').trim());
const isPin=v=>/^[1-9]\d{5}$/.test(String(v||'').trim());

function getApp(){ try{return JSON.parse(localStorage.getItem(APP_KEY)||'null')}catch{return null} }
function setApp(o){ localStorage.setItem(APP_KEY, JSON.stringify(o||{})) }
function routeToStage(stage){
  const s=String(stage||'').toLowerCase();
  if(s==='personal')return 'apply.html';
  if(s==='work')return 'apply.work.html';
  if(s==='kyc')return 'apply.kyc.html';
  if(s==='bank')return 'apply.bank.html';
  if(s==='offer')return 'offer.html';
  if(s==='disbursed')return 'disbursed.html';
  return 'apply.html';
}
function showAppId(id){ if(id){ appIdText.textContent=id; appIdPill.classList.remove('hidden'); } }
function setLocked(locked){
  document.querySelectorAll('#wform input,#wform select').forEach(el=>{
    el.readOnly=locked; if(el.tagName==='SELECT') el.disabled=locked;
    el.classList.toggle('bg-gray-50',locked);
  });
  nextBtn.style.display=locked?'none':'';
  lockNote.classList.toggle('hidden',!locked);
}

// elements
const appIdPill=document.getElementById('appIdPill'), appIdText=document.getElementById('appIdText');
const empType=document.getElementById('empType'), company=document.getElementById('company'), income=document.getElementById('income');
const exp=document.getElementById('exp'), officePin=document.getElementById('officePin'), officeCity=document.getElementById('officeCity'), officeState=document.getElementById('officeState');
const nextBtn=document.getElementById('nextBtn');

function setErr(id,bad){ document.getElementById(id).classList.toggle('has-error',bad); }

function validate(show){
  const v={
    empType: !!empType.value,
    company: company.value.trim().length>=2,
    income: isNum(income.value) && Number(income.value)>0,
    exp: isNum(exp.value) && Number(exp.value)>=0,
    officePin: isPin(officePin.value),
    officeCity: officeCity.value.trim().length>=2,
    officeState: officeState.value.trim().length>=2
  };
  if(show){
    setErr('gEmpType',!v.empType); setErr('gCompany',!v.company); setErr('gIncome',!v.income);
    setErr('gExp',!v.exp); setErr('gOfficePin',!v.officePin); setErr('gOfficeCity',!v.officeCity); setErr('gOfficeState',!v.officeState);
  }
  const ok=Object.values(v).every(Boolean);
  nextBtn.disabled=!ok;
  nextBtn.className = ok ? "px-8 py-3 rounded-full font-semibold text-white bg-[#0A2F33] hover:bg-[#062327] transition"
                         : "px-8 py-3 rounded-full font-semibold text-white bg-gray-300 cursor-not-allowed transition";
  return ok;
}

function saveDraft(){
  const rec={empType:empType.value,company:company.value.trim(),income:income.value.trim(),exp:exp.value.trim(),
    officePin:officePin.value.trim(),officeCity:officeCity.value.trim(),officeState:officeState.value.trim(),ts:Date.now()};
  localStorage.setItem(DRAFT_KEY, JSON.stringify(rec));
}
function loadDraft(){
  try{
    const d=JSON.parse(localStorage.getItem(DRAFT_KEY)||'null'); if(!d) return;
    if(d.empType)empType.value=d.empType; if(d.company)company.value=d.company;
    if(d.income)income.value=d.income; if(d.exp)exp.value=d.exp;
    if(d.officePin)officePin.value=d.officePin; if(d.officeCity)officeCity.value=d.officeCity; if(d.officeState)officeState.value=d.officeState;
  }catch{}
}

['empType','company','income','exp','officePin','officeCity','officeState'].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener('input',()=>{ validate(false); saveDraft(); });
  el.addEventListener('blur', ()=>{ validate(true);  saveDraft(); });
});

// --- Office PIN → auto city/state ---
let officePinTimer=null;
officePin.addEventListener('input',()=>{
  const v=officePin.value.replace(/\D/g,'').slice(0,6);
  officePin.value=v;
  officeCity.value=''; officeState.value='';
  if(officePinTimer) clearTimeout(officePinTimer);
  if(v.length===6) officePinTimer=setTimeout(fetchOfficeAddress,300);
  validate(false); saveDraft();
});
async function fetchOfficeAddress(){
  const p=officePin.value;
  if(!/^[1-9]\d{5}$/.test(p)) return;
  try{
    const r=await fetch('https://api.postalpincode.in/pincode/'+p);
    const d=await r.json();
    const ok=Array.isArray(d)&&d[0]?.Status==='Success'&&d[0]?.PostOffice?.length;
    if(ok){
      const po=d[0].PostOffice[0];
      officeCity.value=po.District||po.Block||'';
      officeState.value=po.State||'';
    } else {
      officeCity.value=''; officeState.value='';
    }
  }catch(e){
    officeCity.value=''; officeState.value='';
    console.error('PIN lookup failed:',e);
  }
  saveDraft(); validate(false);
}

// submit → stage KYC
document.getElementById('wform').addEventListener('submit',e=>e.preventDefault());
nextBtn.addEventListener('click',e=>{
  e.preventDefault();
  if(!validate(true)) return;
  const app=getApp()||{};
  setApp({ ...app, stage:'KYC' });
  setLocked(true);
  window.location.href='apply.kyc.html';
});

// init
(function(){
  const app=getApp()||{};
  if(app?.appId) showAppId(app.appId);
  const stage=(app?.stage)||'Personal';
  if(stage!=='Work'){ setLocked(true); setTimeout(()=>location.href=routeToStage(stage),300); }
  else{ setLocked(false); }
  loadDraft(); validate(false);
})();
</script>
</body>
</html>